<h1>ショッピングカート</h1>

<div>
  <% @cart_items.each do |cart_item| %>
  <div>
    <%= image_tag cart_item.item.get_image(100,100) %>
  </div>
  <div>
    <%= cart_item.item.name %>
  </div>
  <div>
    ￥<%= (cart_item.item.price*1.1).floor %>
  </div>
  <div>
    <%= form_with model: @cart_item, url:cart_item_path(@cart_item), method: :patch, local: true do |f| %>
    <div>
      <%= f.select :amount, *[1..5] %>
    </div>
    <div>
      <%= f.submit "変更", class: 'btn btn-sm btn-success' %>
    </div>
    <% end %>
  </div>
  <div>
    ￥<%= (cart_item.item.price*1.1).floor*(cart_item.amount) %>
  </div>
  <% end %>
</div>

<table>
  <thead>
      <th>単価(税込)</th>
      <th>小計</th>
  </thead>
  <tbody>
  <% @cart_items.each do |cart_item| %>
      <tr>
          <td><%= (cart_item.item.price * 1.1).floor %></td>
          <td><%= (cart_item.item.price * 1.1).floor * cart_item.amount %></td>
          <% @合計金額 +=  (cart_item.item.price * 1.1).floor * cart_item.amount %>
      </tr>
  <% end %>
  </tbody>
</table>